{% extends 'form_master.html' %}


{%block form_content %}


  <form id="previous_employment_form" enctype="multipart/form-data" method="post" class="form-horizontal col-sm-7" enctype="multipart/form-data" data-toggle="validator">

  {% csrf_token %}
  {% if messages %}

            {% for message in messages %}

          <div class="alert alert-danger">
            <button type="button" class="close" data-dismiss="alert" aria-hidden="true"><i class="icon-cross"></i></button>
             <span class="vd_alert-icon"><i class="fa fa-exclamation-circle vd_red"></i></span><strong>{{message}}</strong></div>

            {% endfor %}

         {% endif %}

  <div class="form-group">
    <label class="col-sm-5 control-label">Company Name<span class="mandatory-field"> *</span></label>
    <div class="col-sm-7 controls">
      {{form.company_name}}
      {{company_name_error}}
      {{form.company_name.errors}}
      <div class="help-block with-errors"></div>
    </div>
  </div>

  <div class="form-group">
    <label class="col-sm-5 control-label">Company Address</label>
    <div class="col-sm-7 controls">
      {{form.company_address}}
      {{company_address_errors}}
      {{form.company_address.errors}}
      <div class="help-block with-errors"></div>
    </div>
  </div>

  <div class="form-group">
    <label class="col-sm-5 control-label">Job Type</label>
    <div class="col-sm-7 controls">
      {{form.job_type}}
      {{job_type_errors}}
      {{form.job_type.errors}}
      <div class="help-block with-errors"></div>
    </div>
  </div>

  <div class="form-group">
    <label id ="from_date" class="col-sm-5 control-label">Employed From<span class="mandatory-field"> *</span></label>
    <div class="col-sm-7 controls">
      <div class="input-group">
        {{form.employed_from}}
        {{employed_from_errors}}
        {{form.employed_from.errors}}
      <div class="help-block with-errors"></div>
        <span class="input-group-addon" id="datepicker-icon-trigger" data-datepicker="#datepicker-icon"><i class="fa fa-calendar"></i></span> </div>
    </div>
  </div>
  <div class="form-group">
    <label id="to_date" class="col-sm-5 control-label">Employed To<span class="mandatory-field"> *</span></label>
    <div class="col-sm-7 controls">
      <div class="input-group">
        {{form.employed_upto}}
        {{employed_upto_errors}}
        {{form.employed_upto.errors}}
        <div class="help-block with-errors"></div>        
        <span class="input-group-addon" id="datepicker-icon-trigger" data-datepicker="#datepicker-icon"><i class="fa fa-calendar"></i></span> </div>
    </div>
  </div>
  <div class="form-group">
    <label class="col-sm-5 control-label">Last CTC<span class="mandatory-field"> *</span></label>
    <div id="institute" class="col-sm-7 controls">
      {{form.last_ctc}}
      {{last_ctc_errors}}
      {{form.last_ctc.errors}}
      <div class="help-block with-errors"></div>
    </div>
  </div>
  <div class="form-group">
    <label class="col-sm-5 control-label">Reason for Exit<span class="mandatory-field"> *</span></label>
    <div class="col-sm-7 controls">
      {{form.reason_for_exit}}
      {{reason_for_exit_errors}}
      {{form.board_reason_for_exituniversity.errors}}
      <div class="help-block with-errors"></div>
    </div>
  </div>
  <div class="form-group">
    <label class="col-sm-5 control-label">Pay slips attachments<span class="mandatory-field"> *</span></label>
    <div class="col-sm-7 controls">
      {{form.ps_attachment}}
      {{form.ps_attachment.errors}}
      <div class="help-block with-errors"></div>
    </div>
  </div>

  
  <div class="form-group">
    <label class="col-sm-5 control-label">Relieving letter<span class="mandatory-field"> *</span></label>
    <div class="col-sm-7 controls">
      {{form.rl_attachment}}
      <div class="help-block with-errors"></div>
    </div>
  </div>

  <div class="form-group">
    <label class="col-sm-5 control-label">Offer letter<span class="mandatory-field"> *</span></label>
    <div class="col-sm-7 controls">
      {{form.offer_letter_attachment}}
      <div class="help-block with-errors"></div>
    </div>
  </div>


  
  <div class="form-group">

        <h3 class="col-sm-12 text-right"><input type="submit" id="submit" class="btn vd_bg-green vd_white" value="Save"/></h3>

  </div>
</form>


<div id="user-list" class="col-sm-5">
<!--   <input type="button" id="vivek1" class="btn vd_bg-green vd_white width-10" value="vivek1"/>
  <input type="button" id="vivek2" class="btn vd_bg-green vd_white width-10" value="vivek2"/> -->

  <div class="content-list the-previous">
      <ul class="list-wrapper">
      {% for val in employment_list %}
        <li id="{{val.company_name}}"> 
          <div class="menu-text pull-left">{{val.company_name}}</div>
          
        </li>
        <div class="menu-icon vd_red pull-right"><i id ="{{val.company_name}}" class="glyphicon glyphicon-trash"></i></div>
       {% endfor %}

      </ul>
    </div><!-- ./ content-list -->

  </div><!-- ./ user-list -->

{% endblock %}

            
{% block form_scripts %}
            <script type="text/javascript">



            var theObj = 


                            {
              {%for val in employment_list%}
                              "{{val.company_name}}":{
                                            "company_name": "{{val.company_name}}"
                                              },    
              {%endfor%}   
                            }


                     
            $('.content-list i').click(function(){
              // e.preventDefault();
              // debugger;
              var company_name;
              var the_id_key = $(this).attr('id');
              console.log(the_id_key);
              // Object Iteration
              for (var key in theObj[the_id_key]) {
                console.log(theObj[the_id_key]['company_name']);
                var company_name = theObj[the_id_key]['company_name'];
              }

              swal({   title: "Are you sure you want to delete?",
                    text: "",
                    type: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#DD6B55",
                    confirmButtonText: "Yes",
                    cancelButtonText: "No",
                    closeOnConfirm: true,
                    closeOnCancel: true
                    },
                    function(isConfirm) {
                      if (isConfirm) {
              
                          $.ajax({
                            type: "GET",
                            url : '/user_details/previous_delete',
                            data : {'company_name':company_name},
                            success : function(data){
                             window.location='/user_details/previous_employment'
                             // return data;
                            }
                            // error: function(xhr, status, error) {
                            //   alert(xhr.responseText);
                            // }
                          });
              }}); 
          });
                
                            var theObj = 


                            {
              {%for val in employment_list%}
                              "{{val.company_name}}":{
                                            "company_name": "{{val.company_name}}"
                                              },    
              {%endfor%}   
                            }


                     
            $('.content-list li').click(function(){
              // e.preventDefault();
              // debugger;
              var company_name;
              var the_id_key = $(this).attr('id');
              console.log(the_id_key);
              // Object Iteration
              for (var key in theObj[the_id_key]) {
                console.log(theObj[the_id_key]['company_name']);
                var company_name = theObj[the_id_key]['company_name'];
              }
              
                $.ajax({
                  type: "GET",
                  url : '/user_details/previous_employment',
                  data : {'company_name':company_name},
                  success : function(data){
                   $("#previous_employment_form").html(data);
                   // return data;
                  }
                  // error: function(xhr, status, error) {
                  //   alert(xhr.responseText);
                  // }
                });
              
          });
                  // error: function(xhr, status, error) {
                  //   alert(xhr.responseText);
                  // }
                
            $("#previous_employment_form").submit(function (e) {
                           e.preventDefault();
                           var data = new FormData($('form').get(0));
                           swal({   title: "Do you want to add again?",
                            text: "",
                            type: "warning",
                            showCancelButton: true,
                            confirmButtonColor: "#DD6B55",
                            confirmButtonText: "Save and fill again!",
                            cancelButtonText: "Save and continue to next tab",
                            closeOnConfirm: true,
                            closeOnCancel: true
                            },
                             function(isConfirm) {
                               if (isConfirm) {
                                 $.ajax( {
                                   type: "POST",
                                   url: '/user_details/previous_employment',
                                   data: data,
                                   cache: false,
                                   processData: false,
                                   contentType: false,
                                   success: function( response ) {
                                      window.location='/user_details/previous_employment'
                                   }

                                 });
                               }else{
                                   $.ajax( {
                                     type: "POST",
                                     url: '/user_details/previous_employment',
                                     data: data,
                                     cache: false,
                                     processData: false,
                                     contentType: false,
                                     success: function( response ) {
                                        window.location='/user_details/proof'
                                 }
                               });}});
                             });

                     </script>
{% endblock %}